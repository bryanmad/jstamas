<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, user-scalable=no"
        />
        <title>gross</title>
        <meta content="Bryan M" name="author" />
        <meta name="theme-color" content="indigo" />
        <meta name="robots" content="noindex" />
        <link href="originalgolf.svg" rel="icon" type="image/x-icon" />
        <link rel="apple-touch-icon" sizes="180x180" href="originalgolf.svg" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <link
            href="https://fonts.googleapis.com/css?family=Kalam"
            rel="stylesheet"
        />
        <style>
            :root {
                --team-height: 5vh;
                --team-spacing: 2vh;
            }

            body {
                background-color: dodgerBlue;
                font-family: Helvetica, Arial, sans-serif;
                padding: 0;
                margin: 0;
                box-sizing: border-box;

                //background-image: url("arcot.jpg");
                //height: 250vh;
                //background-position: center;
                //background-repeat: no-repeat;
                //background-size: cover;
                //position: relative;
            }

            /* holds menu */
            .container {
                position: relative;
                height: auto;
            }

            #titlecontainer {
                position: relative;
                height: 10vh;
                //margin-top: 10vh;
            }

            /* for each day */
            #menu1 {
                text-align: center;
                color: white;
                font-size: 8vh;
                height: auto;
            }

            .team {
                position: absolute;
                width: 90%;
                height: var(--team-height);
                background: rgba(105, 105, 105, 0.8);
                box-shadow: 0 3px 5px black;
                left: 50%;
                transform: translateX(-50%);
                top: calc(
                    var(--i) * (var(--team-height) + var(--team-spacing)) + 1vh
                ); /* added top space of 1vh */
                display: flex;
                align-items: center;
                transition-property: top;
                transition-duration: 1500ms;
                border-radius: 10px;
                transition-timing-function: cubic-bezier(
                    0.68,
                    -0.55,
                    0.265,
                    1.55
                );
                border: 4px solid rgba(255, 255, 255, 0.3);
                background-clip: padding-box;
            }

            .name {
                width: 65%;
                display: flex;
                align-items: center;
                justify-content: left;
                font-size: 1.4rem;
                color: white;
                font-weight: 400;
                text-transform: capitalize;
            }

            .score {
                width: 20%;
                font-size: 1.4rem;
                color: white;
                font-weight: 400;
                display: flex;
                text-align: center;
                justify-content: center;
            }

            .position {
                width: 15%;
                font-size: 1.4rem;
                color: white;
                font-weight: 400;
                display: flex;
                text-align: center;
                justify-content: center;
            }

            .team i {
                width: 80px;
                height: var(--team-height);
                display: flex;
                justify-content: center;
                align-items: center;
                color: white;
                font-size: 1.8rem;
                border-radius: 10px;
                border: 4px solid rgba(255, 255, 255, 0.3);
                background-clip: padding-box;
            }

            #warning {
                display: none;
                position: absolute;
                top: 0;
                left: 0;
                background: indigo;
                width: 100vw;
                height: 100vh;
                z-index: 999;
                text-align: center;
                color: white;
                padding-top: 40vh;
                font-size: 6vh;
            }

            /* back arrow */
            .imgbackcontainer {
                position: fixed;
                top: 3vh;
                right: 5vw;
                display: flex;
                align-items: center;
                justify-content: center;
                animation: fadein 1.5s;
                text-shadow:
                    0px 4px 3px rgba(0, 0, 0, 0.4),
                    0px 8px 13px rgba(0, 0, 0, 0.1),
                    0px 18px 23px rgba(0, 0, 0, 0.1);
                background-color: dodgerBlue;
                border-radius: 10px;
                border: 5px solid rgba(255, 255, 255, 0.2);
                box-shadow: 10px 10px 25px black;
                background-clip: padding-box;
                z-index: 9;
                opacity: 1;
            }

            @keyframes fadein {
                0% {
                    opacity: 0;
                }
                100% {
                    opacity: 1;
                }
            }

            #title {
                position: absolute;
                width: 90%;
                height: 10vh;
                background: rgba(105, 105, 105, 0.8);
                box-shadow: 0 3px 5px black;
                left: 50%;
                transform: translateX(-50%);
                top: calc(
                    var(--i) * 2.1 * (var(--team-height) + var(--team-spacing))
                );
                border-radius: 10px;
                border: 4px solid rgba(255, 255, 255, 0.3);
                background-clip: padding-box;
                color: white;
                font-size: 7vw;
                display: block;
            }

            #subtitle {
                font-size: 4vw;
                font-style: italic;
                margin-left: 2vw;
            }

            #spacer4 {
                width: 4vw;
            }

            .spacer2vh {
                height: 2vh;
            }

            #bottom {
                position: absolute;
                width: 90%;
                height: var(--team-height);
                background: transparent;
                left: 50%;
                transform: translateX(-50%);
                top: calc(
                    var(--i) * (var(--team-height) + var(--team-spacing)) + 1vh
                ); /* added top space of 1vh */
                display: flex;
                align-items: center;
                transition-property: top;
                transition-duration: 1500ms;
                border-radius: 10px;
                transition-timing-function: cubic-bezier(
                    0.68,
                    -0.55,
                    0.265,
                    1.55
                );
            }
        </style>
    </head>
    <body>
        <div id="warning">Not available in landscape orientation</div>
        <div class="spacer2vh"></div>
        <div id="titlecontainer">
            <div id="title">
                <div id="spacer4"></div>
                &nbsp;Gross scores
                <div id="spacer4"></div>
                <div id="subtitle">( points minus hcp )</div>
            </div>
        </div>
        <div class="spacer2vh"></div>
        <div id="container" class="container">
            <div
                id="imgbackcontainer"
                class="imgbackcontainer"
                onclick="goBack()"
            >
                <img
                    id="imgback"
                    style="border: 0; height: 20vw; width: 20vw"
                    src="arrow.png"
                    alt="x"
                />
            </div>
            <div class="spacer2vh"></div>
            <div id="menu1"></div>
        </div>

        <script>
            // Detect whether device supports orientationchange event, otherwise fall back to
            // the resize event.
            var supportsOrientationChange = "onorientationchange" in window,
                orientationEvent = supportsOrientationChange
                    ? "orientationchange"
                    : "resize";

            window.addEventListener(
                orientationEvent,
                function () {
                    if (window.orientation == 0) {
                        document.getElementById("warning").style.display =
                            "none";
                    } else if (
                        window.orientation == 90 ||
                        window.orientation == -90
                    ) {
                        document.getElementById("warning").style.display =
                            "block";
                    }
                },
                false,
            );

            //------------------------------------------------------------------------------

            var data;
            var dayCount = 6;
            var url;

            // data is available here
            getData();
            async function getData() {
                url =
                    "https://opensheet.elk.sh/18v--oTO4IICCTf8uCQEmFgItvVFIHukQz9Q0D_Sp1FQ/scores";
                try {
                    const dataStream = await fetch(url);
                    if (!dataStream.ok) {
                        throw new Error(
                            `Response status: ${dataStream.status}`,
                        );
                    }
                    data = await dataStream.json();
                    // don't need blank players
                    data = data.filter(function (el) {
                        return el.players !== "----------";
                    });
                    // sort by score, highest first
                    data.sort(
                        (a, b) =>
                            parseInt(b.playergross) - parseInt(a.playergross),
                    );
                } catch (error) {
                    console.error(error.message);
                }
                useData();
            }

            function useData() {
                let container = document.getElementById("menu1");
                // empty container
                container.innerHTML = "";

                data.forEach((e, i) => (e.rank = i));
                var ii = 0;
                // build screen
                data.forEach((el, i) => {
                    ii++;
                    let box = document.createElement("div");
                    box.id = "box" + i;
                    box.className = "team";
                    box.style.setProperty("--i", i);
                    let name = document.createElement("span");
                    name.id = "name" + i;
                    name.className = "name";
                    let score = document.createElement("span");
                    score.id = "score" + i;
                    score.className = "score";
                    let position = document.createElement("span");
                    position.id = "position" + i;
                    position.className = "position";
                    position.innerHTML = el.position;
                    box.appendChild(position);
                    box.appendChild(name);
                    box.appendChild(score);
                    box.style.setProperty("--color", el.color);
                    container.appendChild(box);
                    // fade the initial view
                    box.style.opacity = 0.3;
                });

                // add extra box at bottom
                ii++;
                let box = document.createElement("div");
                box.id = "bottom";
                box.className = "bottom";
                box.style.setProperty("--i", ii);
                container.appendChild(box);
                // fade the initial view
                box.style.opacity = 0.3;

                j = 0;

                data.forEach((elstartx, j) => {
                    initialBodyUpdate(elstartx.players, j);
                });

                k = 0;
                // do proper display
                data.forEach((el) => {
                    k++;
                    setTimeout(function () {
                        if (el.players !== "") {
                            bodyUpdate(el.players, el.playergross);
                        }
                    }, k * 300);
                });
            }

            function bodyUpdate(nom, scr) {
                let elName = nom;
                data.find((team) => team.players === elName);
                // now sort out positions for same scores
                var held = 1;
                var heldscore = 0;
                data.forEach((elem, ind) => {
                    if (elem.playergross == heldscore) {
                        elem.position = held;
                    } else {
                        elem.position = ind + 1;
                    }
                    held = elem.position;
                    heldscore = elem.playergross;
                });
                let AllTeams = Array.from(document.querySelectorAll(".team"));
                var k = 0;
                AllTeams.forEach((element) => {
                    let elementName = element.querySelector(".name");
                    let elementScore = element.querySelector(".score");
                    if (elementName.innerHTML == elName) {
                        elementScore.innerHTML = scr;
                        let newRank = data.find(
                            (team) => team.players === elementName.innerHTML,
                        ).rank;
                        // move player position
                        // setProperty(propertyName, value)
                        element.style.opacity = 1; //0.4;
                        element.style.setProperty("--i", newRank);
                        setTimeout(function () {
                            element.style.opacity = 1;
                        }, 800);
                        let elementPos = element.querySelector(".position");
                        elementPos.innerText = data.find(
                            (team) => team.players === elementName.innerHTML,
                        ).position;
                    }
                });
            }

            function initialBodyUpdate(nom, pos) {
                document.getElementById("name" + pos).innerText = nom;
                document.getElementById("position" + pos).innerText = "";
            }

            function goBack() {
                location.href = "jsfront.html";
            }
        </script>
    </body>
</html>
